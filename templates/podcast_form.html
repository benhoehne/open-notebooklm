<form id="podcast-form" method="POST" action="{{ url_for('generate_podcast') }}" enctype="multipart/form-data" class="space-y-8 px-6">
  
  <!-- Content Input Section -->
  <div class="border-b border-white/10 pb-8 px-4">
    <h2 class="text-base/7 font-semibold text-white">Content Sources</h2>
    <p class="mt-1 text-sm/6 text-gray-400">Upload your documents to create an engaging podcast conversation.</p>

    <div class="mt-6 space-y-6">
      
      <!-- File Upload -->
      <div>
        <label for="pdf_files" class="block text-sm/6 font-medium text-white hidden">Upload PDF Documents</label>
        <div class="mt-2 flex justify-center rounded-lg border border-dashed border-white/25 px-6 py-8">
          <div class="text-center" id="upload-display-area">
            <svg class="mx-auto size-10 text-gray-500" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0 0 16.5 9h-1.875a1.875 1.875 0 0 1-1.875-1.875V5.25A3.75 3.75 0 0 0 9 1.5H5.625ZM7.5 15a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 7.5 15Zm.75-4.5a.75.75 0 0 0 0 1.5h7.5a.75.75 0 0 0 0-1.5h-7.5Z" clip-rule="evenodd" />
            </svg>
            <div class="mt-3 flex text-sm/6 text-gray-400">
              <label for="pdf_files" class="relative cursor-pointer rounded-md bg-gray-900 font-semibold text-white hover:text-indigo-500">
                <span>Upload PDF files</span>
                <input id="pdf_files" name="pdf_files" type="file" multiple accept=".pdf" class="sr-only">
              </label>
              <p class="pl-1">or drag and drop</p>
            </div>
            <p class="text-xs/5 text-gray-400">PDF files up to 10MB each</p>
          </div>
        </div>
        <!-- Selected files display -->
        <div id="selected-files-display" class="mt-3 hidden">
          <div class="rounded-lg bg-indigo-900/20 border border-indigo-500/30 p-4">
            <div class="flex items-center">
              <svg class="w-5 h-5 text-indigo-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" />
              </svg>
              <span class="text-sm font-medium text-indigo-300" id="file-count-display">0 files selected</span>
            </div>
            <div id="file-list-display" class="mt-2 space-y-1"></div>
          </div>
        </div>
      </div>

      <!-- URL Input -->
      <div class="hidden">
        <label for="url" class="block text-sm/6 font-medium text-white">Website URL (Optional)</label>
        <div class="mt-2">
          <input id="url" name="url" type="url" placeholder="https://example.com/article" class="block w-full rounded-md bg-white/5 px-3 py-1.5 text-base text-white outline-1 -outline-offset-1 outline-white/10 placeholder:text-gray-500 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-500 sm:text-sm/6">
        </div>
        <p class="mt-2 text-sm/6 text-gray-400">Add a URL to include web content in your podcast.</p>
      </div>

      <!-- Question/Topic -->
      <div>
        <label for="question" class="block text-sm/6 font-medium text-white">Specific Question or Topic (Optional)</label>
        <div class="mt-2">
          <textarea id="question" name="question" rows="3" placeholder="Enter a specific question or topic you'd like the podcast to focus on..." class="block w-full rounded-md bg-white/5 px-3 py-1.5 text-base text-white outline-1 -outline-offset-1 outline-white/10 placeholder:text-gray-500 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-500 sm:text-sm/6"></textarea>
        </div>
        <p class="mt-2 text-sm/6 text-gray-400">Help guide the conversation with a specific angle or question.</p>
      </div>

      <!-- Script Import -->
      <div>
        <label for="script_file" class="block text-sm/6 font-medium text-white">Import Script File (Optional)</label>
        <div class="mt-2 flex justify-center rounded-lg border border-dashed border-white/25 px-6 py-4">
          <div class="text-center">
            <svg class="mx-auto size-8 text-gray-500" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
            </svg>
            <div class="mt-2 flex text-sm/6 text-gray-400">
              <label for="script_file" class="relative cursor-pointer rounded-md bg-gray-900 font-semibold text-white hover:text-indigo-500">
                <span>Upload Markdown Script</span>
                <input id="script_file" name="script_file" type="file" accept=".md,.txt" class="sr-only">
              </label>
            </div>
            <p class="text-xs/5 text-gray-400">Upload a .md file to skip script generation</p>
          </div>
        </div>
        <!-- Script file display -->
        <div id="script-file-display" class="mt-3 hidden">
          <div class="rounded-lg bg-emerald-900/20 border border-emerald-500/30 p-4">
            <div class="flex items-center">
              <svg class="w-5 h-5 text-emerald-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
              </svg>
              <span class="text-sm font-medium text-emerald-300" id="script-file-name"></span>
            </div>
          </div>
        </div>
        <p class="mt-2 text-sm/6 text-gray-400">Import an existing script to skip content processing and go directly to audio generation. <strong>Script files take priority over all other content sources.</strong></p>
      </div>

    </div>
  </div>

  <!-- Podcast Configuration Section -->
  <div class="border-b border-white/10 pb-8">
    <h2 class="text-base/7 font-semibold text-white">🎙️ Podcast Settings</h2>
    <p class="mt-1 text-sm/6 text-gray-400">Customize the tone, length, and language of your generated podcast.</p>

    <div class="mt-6 grid grid-cols-1 gap-6 sm:grid-cols-3 py-4">
      
      <!-- Tone Selection -->
      <div>
        <label for="tone" class="block text-sm/6 font-medium text-white">Tone</label>
        <div class="mt-2 grid grid-cols-1">
          <select id="tone" name="tone" class="col-start-1 row-start-1 w-full appearance-none rounded-md bg-white/5 py-1.5 pr-8 pl-3 text-base text-white outline-1 -outline-offset-1 outline-white/10 *:bg-gray-800 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-500 sm:text-sm/6">
            <option value="Educational">Educational</option>
            <option value="Fun">Fun</option>
            <option value="Formal">Formal</option>
          </select>
          <svg class="pointer-events-none col-start-1 row-start-1 mr-2 size-5 self-center justify-self-end text-gray-400 sm:size-4" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
          </svg>
        </div>
      </div>

      <!-- Length Selection -->
      <div>
        <label for="length" class="block text-sm/6 font-medium text-white">Length</label>
        <div class="mt-2 grid grid-cols-1">
          <select id="length" name="length" class="col-start-1 row-start-1 w-full appearance-none rounded-md bg-white/5 py-1.5 pr-8 pl-3 text-base text-white outline-1 -outline-offset-1 outline-white/10 *:bg-gray-800 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-500 sm:text-sm/6">
            <option value="Short (1-2 min)">Short (1-2 min)</option>
            <option value="Medium (3-5 min)">Medium (3-5 min)</option>
            <option value="Long (10-12 min)">Long (10-12 min)</option>
          </select>
          <svg class="pointer-events-none col-start-1 row-start-1 mr-2 size-5 self-center justify-self-end text-gray-400 sm:size-4" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
          </svg>
        </div>
      </div>

      <!-- Language Selection -->
      <div>
        <label for="language" class="block text-sm/6 font-medium text-white">Language</label>
        <div class="mt-2 grid grid-cols-1">
          <select id="language" name="language" class="col-start-1 row-start-1 w-full appearance-none rounded-md bg-white/5 py-1.5 pr-8 pl-3 text-base text-white outline-1 -outline-offset-1 outline-white/10 *:bg-gray-800 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-500 sm:text-sm/6">
            <option value="English">🇺🇸 English</option>
            <option value="Spanish">🇪🇸 Spanish</option>
            <option value="French">🇫🇷 French</option>
            <option value="German">🇩🇪 German</option>
            <option value="Italian">🇮🇹 Italian</option>
            <option value="Portuguese">🇵🇹 Portuguese</option>
            <option value="Dutch">🇳🇱 Dutch</option>
            <option value="Polish">🇵🇱 Polish</option>
            <option value="Russian">🇷🇺 Russian</option>
            <option value="Japanese">🇯🇵 Japanese</option>
            <option value="Korean">🇰🇷 Korean</option>
            <option value="Chinese">🇨🇳 Chinese</option>
            <option value="Hindi">🇮🇳 Hindi</option>
          </select>
          <svg class="pointer-events-none col-start-1 row-start-1 mr-2 size-5 self-center justify-self-end text-gray-400 sm:size-4" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
          </svg>
        </div>
      </div>

    </div>
  </div>

  <!-- Host & Guest Configuration Section -->
  <div class="border-b border-white/10 pb-8">
    <h2 class="text-base/7 font-semibold text-white">👥 Host & Guest Settings</h2>
    <p class="mt-1 text-sm/6 text-gray-400">Customize the names and voices of your podcast hosts.</p>

    <div class="mt-6 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4 py-4">
      
      <!-- Host Name -->
      <div>
        <label for="host_name" class="block text-sm/6 font-medium text-white">Host Name</label>
        <div class="mt-2">
          <input id="host_name" name="host_name" type="text" value="Sam" placeholder="Enter host name" class="block w-full rounded-md bg-white/5 px-3 py-1.5 text-base text-white outline-1 -outline-offset-1 outline-white/10 placeholder:text-gray-500 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-500 sm:text-sm/6">
        </div>
      </div>

      <!-- Host Gender -->
      <div>
        <label for="host_gender" class="block text-sm/6 font-medium text-white">Host Voice</label>
        <div class="mt-2 grid grid-cols-1">
          <select id="host_gender" name="host_gender" class="col-start-1 row-start-1 w-full appearance-none rounded-md bg-white/5 py-1.5 pr-8 pl-3 text-base text-white outline-1 -outline-offset-1 outline-white/10 *:bg-gray-800 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-500 sm:text-sm/6">
            <option value="random">🎲 Random</option>
            <option value="male">👨 Male Voice</option>
            <option value="female">👩 Female Voice</option>
          </select>
          <svg class="pointer-events-none col-start-1 row-start-1 mr-2 size-5 self-center justify-self-end text-gray-400 sm:size-4" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
          </svg>
        </div>
      </div>

      <!-- Guest Name -->
      <div>
        <label for="guest_name" class="block text-sm/6 font-medium text-white">Guest Name (Optional)</label>
        <div class="mt-2">
          <input id="guest_name" name="guest_name" type="text" placeholder="AI will choose if empty" class="block w-full rounded-md bg-white/5 px-3 py-1.5 text-base text-white outline-1 -outline-offset-1 outline-white/10 placeholder:text-gray-500 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-500 sm:text-sm/6">
        </div>
      </div>

      <!-- Guest Gender -->
      <div>
        <label for="guest_gender" class="block text-sm/6 font-medium text-white">Guest Voice</label>
        <div class="mt-2 grid grid-cols-1">
          <select id="guest_gender" name="guest_gender" class="col-start-1 row-start-1 w-full appearance-none rounded-md bg-white/5 py-1.5 pr-8 pl-3 text-base text-white outline-1 -outline-offset-1 outline-white/10 *:bg-gray-800 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-500 sm:text-sm/6">
            <option value="random">🎲 Random</option>
            <option value="male">👨 Male Voice</option>
            <option value="female">👩 Female Voice</option>
          </select>
          <svg class="pointer-events-none col-start-1 row-start-1 mr-2 size-5 self-center justify-self-end text-gray-400 sm:size-4" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
          </svg>
        </div>
      </div>

    </div>
  </div>

  <!-- Advanced Options Section -->
  <div class="pb-8 hidden">
    <h2 class="text-base/7 font-semibold text-white">⚙️ Advanced Options</h2>
    <p class="mt-1 text-sm/6 text-gray-400">Experimental features and additional customization options.</p>

    <div class="mt-6">
      <div class="flex gap-3">
        <div class="flex h-6 shrink-0 items-center">
          <div class="group grid size-4 grid-cols-1">
            <input id="use_advanced_audio" name="use_advanced_audio" type="checkbox" value="1" class="col-start-1 row-start-1 appearance-none rounded-sm border border-white/10 bg-white/5 checked:border-indigo-600 checked:bg-indigo-600 indeterminate:border-indigo-600 indeterminate:bg-indigo-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:border-white/10 disabled:bg-transparent forced-colors:appearance-auto">
            <svg class="pointer-events-none col-start-1 row-start-1 size-3.5 self-center justify-self-center stroke-white group-has-disabled:stroke-white/25" viewBox="0 0 14 14" fill="none">
              <path class="opacity-0 group-has-checked:opacity-100" d="M3 8L6 11L11 3.5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </div>
        </div>
        <div class="text-sm/6">
          <label for="use_advanced_audio" class="font-medium text-white">Use Bark Audio (Experimental)</label>
          <p class="text-gray-400">Enable experimental Bark TTS for potentially more natural voice generation. May be slower.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="flex items-center justify-end gap-x-6">
    <button type="button" onclick="clearForm()" class="text-sm/6 font-semibold text-white hover:text-gray-300">Clear Form</button>
    <button type="button" onclick="generateScript()" class="rounded-md bg-emerald-600 px-6 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-600">
      📝 Generate Script
    </button>
    <button type="submit" class="rounded-md bg-indigo-600 px-6 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
      🎙️ Generate Podcast
    </button>
  </div>
</form>

<script>
// Define generateScript function for the button
function generateScript() {
  // Change form action to generate script only
  const form = document.getElementById('podcast-form');
  const originalAction = form.action;
  form.action = "{{ url_for('generate_script_only') }}";
  
  // Show loading
  if (typeof showLoading === 'function') {
    showLoading();
  }
  
  // Submit form
  form.submit();
  
  // Restore original action (though page will reload)
  form.action = originalAction;
}

// Define checkContentPriority function globally
window.checkContentPriority = function() {
  const scriptFile = document.getElementById('script_file').files[0];
  const pdfFiles = document.getElementById('pdf_files').files;
  const urlField = document.getElementById('url').value.trim();
  
  // Remove any existing priority warning
  const existingWarning = document.getElementById('priority-warning');
  if (existingWarning) {
    existingWarning.remove();
  }
  
  // If script is uploaded and other content exists, show warning
  if (scriptFile && (pdfFiles.length > 0 || urlField)) {
    const warningDiv = document.createElement('div');
    warningDiv.id = 'priority-warning';
    warningDiv.className = 'mt-4 p-3 bg-amber-900/20 border border-amber-500/30 rounded-lg';
    warningDiv.innerHTML = `
      <div class="flex items-center">
        <svg class="w-5 h-5 text-amber-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
        </svg>
        <span class="text-sm text-amber-300">
          <strong>Script file detected:</strong> PDF files and URL will be ignored. Only the uploaded script will be used.
        </span>
      </div>
    `;
    
    // Insert after the script file display
    const scriptSection = document.getElementById('script-file-display').parentElement;
    scriptSection.appendChild(warningDiv);
  }
}

// Note: File upload handling is managed by app.js
// We only need to ensure checkContentPriority is called when needed
document.addEventListener('DOMContentLoaded', function() {
  // Add listener for URL changes
  const urlInput = document.getElementById('url');
  if (urlInput) {
    urlInput.addEventListener('input', checkContentPriority);
  }
});
</script>
